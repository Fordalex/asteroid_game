{% extends 'base.html' %}
{% block header %}
Pong
{% endblock %}
{% block content %}



<div class="row m-0 p-0 justify-content-center">
    <div class="col-12 d-flex justify-content-center m-0 p-0 mb-2">
        <div class="white-container pong-stats-width">
            <div class="d-flex justify-content-between">
                <p class="text-center m-0">Welcome {{ playersName }}!</p>
                <p class="m-0">Room Size: <span id="roomSize"></span></p>
                <p class="text-center m-0">Lobby: {{ room }}</p>
            </div>
            <hr class="mb-1">
            <div id="joinedRoomContainer"></div>
            <hr class="mt-1">
            <div class="d-flex justify-content-between">
                <p class="text-center m-0">Player One is: <span id="playerOne"></span></p>
                <p class="text-center m-0">Player Two is: <span id="playerTwo"></span></p>
            </div>
        </div>
    </div>
    <div class="col-12 d-flex justify-content-center">
        <div id="canvasContainer"></div>
    </div>
</div>


{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href='{{ url_for("static", filename="css/pong.css") }}'>
{% endblock %}

{% block extra_js %}

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/p5.js"
    integrity="sha512-rMaqGbYalDaQz0lWNF2L8DHPtf4NW+gSZomExS0LcsNyRS4Rmj21+dt97XfXCZE/E569eX72Bh//Jt1EpStgiA=="
    crossorigin="anonymous"></script>
<script src='{{ url_for('static', filename="js/pong/main.js") }}'></script>

<script>

const socket = io.connect("http://localhost:5001/");

$(document).ready(function() {
    setTimeout(function() {
        var canvas = $('#defaultCanvas0')
        $('#defaultCanvas0').remove()
        $('#canvasContainer').html(canvas)
    }, 100)
    console.log(socket)
    socket.emit('join_room', {
        playersName: "{{ playersName }}",
        room: "{{ room }}",
    })
});

var canvasHeight = 600;
var canvasWidth = 600;

function setup() {
    createCanvas(canvasWidth, canvasHeight)
}

var playerOneX = 20;
var playerOneY = 20;

var playerTwoX = canvasWidth - 20;
var playerTwoY = 20;

function draw() {
    background(15);
    rect(playerOneX, playerOneY, 10, 70);
    rect(playerTwoX, playerTwoY, 10, 70);
}

window.addEventListener('keydown', function(e) {
    if (e.key == 's') {
        if (playerOneY + 77 < canvasHeight) {
            playerOneY += 20;
            socket.emit('playerOne_position', {
                y: playerOneY,
                room: '{{ room }}',
            })
        }
    }
    if (e.key == 'w') {
        if (playerOneY > 0) {
            playerOneY -= 20;
            socket.emit('playerOne_position', {
                y: playerOneY,
                room: '{{ room }}',
            })
        }
    }
})

socket.on('playerOne_position_received', function(e) {
    playerOneY = e['y']
})
socket.on('join_room_announcement',function(e) {

    $('#roomSize').html(e['room'].length)
    $('#joinedRoomContainer').append(`<p class="m-0"><b>${e['playersName']}</b> Has joined!</p>`)
})

</script>
{% endblock %}
